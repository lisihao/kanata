# Kanata æ‰§è¡Œè®¡åˆ’ï¼šæ¶æ„åˆ†å±‚ / äººå‘˜åˆ†å·¥ / ä»»åŠ¡æ‹†åˆ†

**ç‰ˆæœ¬**: v1.0
**æ—¥æœŸ**: 2026-01-31
**ç›®æ ‡**: MVP 1 å‘¨äº¤ä»˜ï¼Œæ­¤åæ¯æ—¥è¿­ä»£

---

## å›¢é˜Ÿåå†Œ

| è§’è‰² | å§“å | ä»£å· |
|------|------|------|
| Sponsor / äº§å“å†³ç­– | Jianmin Lu | Sponsor |
| Developer A | Baoxing Huai | A |
| Developer B | Junjie Duan | B |
| Developer C | Sihao Li | C |

---

## ä¸€ã€æ¶æ„åˆ†å±‚æ€»è§ˆ

### 1.1 å››å±‚æ¶æ„

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                  â•‘
â•‘  L1  è¡¨ç°å±‚ (Presentation Layer)                    â† Dev A      â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚  CLI TUI        é…ç½®ç®¡ç†       å‘½ä»¤ç³»ç»Ÿ      æµå¼æ¸²æŸ“      â”‚  â•‘
â•‘  â”‚  (ç»ˆç«¯äº¤äº’)    (config.yaml)  (/slash cmd)  (Markdown/Diff)â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                              â”‚ AgentSession trait                 â•‘
â•‘                              â†“                                   â•‘
â•‘  L2  ç¼–æ’å±‚ (Orchestration Layer)                   â† Dev B      â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚  Agent Loop      Context       Skill         System       â”‚  â•‘
â•‘  â”‚  (å¯¹è¯å¾ªç¯)     Assembler     Dispatcher     Prompt       â”‚  â•‘
â•‘  â”‚                 (ä¸Šä¸‹æ–‡è£…é…)   (Skillè°ƒåº¦)    Manager      â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘            â”‚ Tool trait    â”‚ Skill trait   â”‚ LLMClient trait      â•‘
â•‘            â†“               â†“               â†“                     â•‘
â•‘  L3  èƒ½åŠ›å±‚ (Capability Layer)               â† Dev B + Dev C     â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚  Tool Registry   â”‚ â”‚  Skill Registry  â”‚ â”‚  Model Router   â”‚  â•‘
â•‘  â”‚                  â”‚ â”‚                  â”‚ â”‚                 â”‚  â•‘
â•‘  â”‚  - Read          â”‚ â”‚  - commit        â”‚ â”‚  - Anthropic    â”‚  â•‘
â•‘  â”‚  - Write         â”‚ â”‚  - review        â”‚ â”‚  - OpenAI compatâ”‚  â•‘
â•‘  â”‚  - Edit          â”‚ â”‚  - explain       â”‚ â”‚  - DeepSeek     â”‚  â•‘
â•‘  â”‚  - Glob          â”‚ â”‚                  â”‚ â”‚                 â”‚  â•‘
â•‘  â”‚  - Grep          â”‚ â”‚  (YAML å®šä¹‰      â”‚ â”‚  (ç»Ÿä¸€æŠ½è±¡      â”‚  â•‘
â•‘  â”‚  - Bash          â”‚ â”‚   çƒ­åŠ è½½)        â”‚ â”‚   æµå¼å“åº”)     â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘           â† Dev B (Tools+Skills)              â† Dev C (Model)    â•‘
â•‘                                                                  â•‘
â•‘  L4  åŸºç¡€å±‚ (Foundation Layer)                      â† ä¸‰äººå…±å»º    â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚  Common Types    Error Handling    Token Tracking   Config â”‚  â•‘
â•‘  â”‚  (å…±äº«ç±»å‹)      (ç»Ÿä¸€é”™è¯¯)        (Tokenç»Ÿè®¡)     (é…ç½®)  â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                                                                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### 1.2 Cargo Workspace ç»“æ„

```
kanata/
â”œâ”€â”€ Cargo.toml                    # workspace æ ¹ (ä¸‰äºº D1 å…±åŒç¡®å®š)
â”‚
â”œâ”€â”€ crates/
â”‚   â”œâ”€â”€ kanata-types/             # L4: å…±äº«ç±»å‹å’Œæ¥å£å®šä¹‰ â† ä¸‰äººå…±å»º
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ lib.rs
â”‚   â”‚       â”œâ”€â”€ message.rs        # Message, UserContent, AgentEvent
â”‚   â”‚       â”œâ”€â”€ tool.rs           # Tool trait, ToolDefinition, ToolResult
â”‚   â”‚       â”œâ”€â”€ skill.rs          # SkillDefinition, SkillRegistry trait
â”‚   â”‚       â”œâ”€â”€ llm.rs            # LLMClient trait, StreamEvent, TokenUsage
â”‚   â”‚       â”œâ”€â”€ session.rs        # AgentSession trait, SessionTokenStats
â”‚   â”‚       â”œâ”€â”€ config.rs         # KanataConfig, ModelConfig, KeyConfig
â”‚   â”‚       â””â”€â”€ error.rs          # KanataError ç»Ÿä¸€é”™è¯¯ç±»å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ kanata-cli/               # L1: CLI ç»ˆç«¯ â† Dev A
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ main.rs           # å…¥å£
â”‚   â”‚       â”œâ”€â”€ app.rs            # TUI Application ä¸»å¾ªç¯
â”‚   â”‚       â”œâ”€â”€ ui/
â”‚   â”‚       â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ input.rs      # è¾“å…¥æ¡†ç»„ä»¶
â”‚   â”‚       â”‚   â”œâ”€â”€ output.rs     # è¾“å‡ºæ¸²æŸ“ (Markdown/ä»£ç é«˜äº®/Diff)
â”‚   â”‚       â”‚   â”œâ”€â”€ status.rs     # çŠ¶æ€æ  (Token/æ¨¡å‹/ä¼šè¯)
â”‚   â”‚       â”‚   â””â”€â”€ spinner.rs    # åŠ è½½åŠ¨ç”»
â”‚   â”‚       â”œâ”€â”€ commands.rs       # /help /model /cost /clear /undo
â”‚   â”‚       â”œâ”€â”€ config.rs         # ~/.kanata/config.yaml è¯»å†™
â”‚   â”‚       â”œâ”€â”€ session.rs        # ä¼šè¯æŒä¹…åŒ–ä¸æ¢å¤
â”‚   â”‚       â””â”€â”€ migrate.rs        # ç«å“é…ç½®è¿ç§» (.claude/ .cursorrules)
â”‚   â”‚
â”‚   â”œâ”€â”€ kanata-core/              # L2: Agent ç¼–æ’æ ¸å¿ƒ â† Dev B
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ lib.rs
â”‚   â”‚       â”œâ”€â”€ agent.rs          # Agent ä¸»å¾ªç¯ (implements AgentSession)
â”‚   â”‚       â”œâ”€â”€ context.rs        # ä¸Šä¸‹æ–‡è£…é…å™¨ (Context Assembler)
â”‚   â”‚       â”œâ”€â”€ dispatcher.rs     # å·¥å…·åˆ†å‘ + Skill åˆ†å‘
â”‚   â”‚       â”œâ”€â”€ prompt/
â”‚   â”‚       â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ system.rs     # System Prompt åŠ è½½ä¸ç®¡ç†
â”‚   â”‚       â”‚   â””â”€â”€ templates.rs  # Prompt æ¨¡æ¿
â”‚   â”‚       â”œâ”€â”€ memory.rs         # Project Memory (.kanata/memory.yaml)
â”‚   â”‚       â””â”€â”€ undo.rs           # æ“ä½œæ—¥å¿— + Undo æœºåˆ¶
â”‚   â”‚
â”‚   â”œâ”€â”€ kanata-tools/             # L3a: å·¥å…·å®ç° â† Dev B
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ lib.rs            # ToolRegistry å®ç°
â”‚   â”‚       â”œâ”€â”€ read.rs
â”‚   â”‚       â”œâ”€â”€ write.rs
â”‚   â”‚       â”œâ”€â”€ edit.rs
â”‚   â”‚       â”œâ”€â”€ glob.rs
â”‚   â”‚       â”œâ”€â”€ grep.rs
â”‚   â”‚       â”œâ”€â”€ bash.rs           # å«å®‰å…¨æ‹¦æˆª
â”‚   â”‚       â””â”€â”€ safety.rs         # è·¯å¾„ç™½åå• + å‘½ä»¤é»‘åå•
â”‚   â”‚
â”‚   â”œâ”€â”€ kanata-skills/            # L3b: Skill æ¡†æ¶ â† Dev B
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ lib.rs            # SkillRegistry å®ç°
â”‚   â”‚       â”œâ”€â”€ loader.rs         # YAML Skill åŠ è½½å™¨
â”‚   â”‚       â”œâ”€â”€ builtin/
â”‚   â”‚       â”‚   â”œâ”€â”€ commit.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ review.rs
â”‚   â”‚       â”‚   â””â”€â”€ explain.rs
â”‚   â”‚       â””â”€â”€ workflow.rs       # Skill ç¼–æ’ (DAG)
â”‚   â”‚
â”‚   â”œâ”€â”€ kanata-model/             # L3c: æ¨¡å‹å¯¹æ¥ â† Dev C
â”‚   â”‚   â””â”€â”€ src/
â”‚   â”‚       â”œâ”€â”€ lib.rs            # ModelRouter å®ç°
â”‚   â”‚       â”œâ”€â”€ client.rs         # ç»Ÿä¸€ LLMClient æŠ½è±¡
â”‚   â”‚       â”œâ”€â”€ providers/
â”‚   â”‚       â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚       â”‚   â”œâ”€â”€ anthropic.rs  # Claude API (Messages API + SSE)
â”‚   â”‚       â”‚   â”œâ”€â”€ openai.rs     # OpenAI å…¼å®¹ (GPT/DeepSeek/Qwen/...)
â”‚   â”‚       â”‚   â””â”€â”€ mock.rs       # Mock Client (å¼€å‘æµ‹è¯•ç”¨)
â”‚   â”‚       â”œâ”€â”€ stream.rs         # SSE æµå¼è§£æ + tool_use è§£æ
â”‚   â”‚       â”œâ”€â”€ token.rs          # Token è®¡æ•° + æˆæœ¬è®¡ç®—
â”‚   â”‚       â”œâ”€â”€ retry.rs          # é‡è¯• + æŒ‡æ•°é€€é¿ + Rate Limit å¤„ç†
â”‚   â”‚       â””â”€â”€ key_pool.rs       # API Key æ±  (åŸºç¡€ç‰ˆ: è½®è¯¢ + å¥åº·æ£€æŸ¥)
â”‚   â”‚
â”‚   â””â”€â”€ kanata-test/              # é›†æˆæµ‹è¯• â† ä¸‰äººå…±å»º
â”‚       â””â”€â”€ tests/
â”‚           â”œâ”€â”€ e2e_basic.rs      # åŸºç¡€ç«¯åˆ°ç«¯æµç¨‹
â”‚           â”œâ”€â”€ tool_tests.rs
â”‚           â”œâ”€â”€ model_tests.rs
â”‚           â””â”€â”€ fixtures/         # æµ‹è¯•ç”¨çš„é¡¹ç›®ç›®å½•
â”‚
â”œâ”€â”€ skills/                       # å†…ç½® Skill YAML å®šä¹‰ â† Dev B
â”‚   â”œâ”€â”€ commit.skill.yaml
â”‚   â”œâ”€â”€ review.skill.yaml
â”‚   â””â”€â”€ explain.skill.yaml
â”‚
â”œâ”€â”€ prompts/                      # System Prompt æ–‡ä»¶ â† Dev B
â”‚   â”œâ”€â”€ system.md                 # æ ¸å¿ƒ System Prompt
â”‚   â””â”€â”€ personas/
â”‚       â””â”€â”€ coder.md
â”‚
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â”œâ”€â”€ ci.yml                # lint + test + build â† Dev C
â”‚       â””â”€â”€ release.yml           # å¤šå¹³å°å‘å¸ƒ â† Dev C
â”‚
â””â”€â”€ docs/
    â”œâ”€â”€ PRD.md
    â”œâ”€â”€ PRD-supplement.md
    â””â”€â”€ EXECUTION-PLAN.md         # æœ¬æ–‡æ¡£
```

### 1.3 å±‚é—´æ¥å£å¥‘çº¦ (Day 1 é”å®š)

```rust
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// crates/kanata-types/src/llm.rs
// å®ç°æ–¹: Dev C (kanata-model)
// è°ƒç”¨æ–¹: Dev B (kanata-core)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

use async_trait::async_trait;
use futures::Stream;
use std::pin::Pin;

/// æ¨¡å‹æµå¼äº‹ä»¶
#[derive(Debug, Clone)]
pub enum StreamEvent {
    /// æ–‡æœ¬ delta
    TextDelta(String),
    /// å·¥å…·è°ƒç”¨å¼€å§‹
    ToolUseStart { id: String, name: String },
    /// å·¥å…·è°ƒç”¨è¾“å…¥ delta (JSON ç‰‡æ®µ)
    ToolUseDelta(String),
    /// å·¥å…·è°ƒç”¨ç»“æŸ
    ToolUseEnd,
    /// æ¶ˆæ¯ç»“æŸ
    MessageEnd { usage: TokenUsage },
    /// é”™è¯¯
    Error(String),
}

/// Token ç”¨é‡
#[derive(Debug, Clone, Default)]
pub struct TokenUsage {
    pub input_tokens: u32,
    pub output_tokens: u32,
    pub cache_read_tokens: u32,
    pub cache_write_tokens: u32,
    pub model: String,
    pub cost_usd: f64,
}

/// LLM å®¢æˆ·ç«¯ç»Ÿä¸€æ¥å£
#[async_trait]
pub trait LLMClient: Send + Sync {
    /// æµå¼å¯¹è¯
    async fn chat_stream(
        &self,
        messages: &[Message],
        tools: &[ToolDefinition],
        system: &str,
    ) -> Result<Pin<Box<dyn Stream<Item = Result<StreamEvent>> + Send>>, KanataError>;

    /// æ¨¡å‹åç§°
    fn model_name(&self) -> &str;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// crates/kanata-types/src/tool.rs
// å®ç°æ–¹: Dev B (kanata-tools)
// è°ƒç”¨æ–¹: Dev B (kanata-core)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/// å·¥å…·æ‰§è¡Œç»“æœ
#[derive(Debug, Clone)]
pub struct ToolResult {
    pub content: String,
    pub is_error: bool,
}

/// å·¥å…·å®šä¹‰ (ç»™ LLM çš„ JSON Schema)
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct ToolDefinition {
    pub name: String,
    pub description: String,
    pub input_schema: serde_json::Value,
}

/// å·¥å…·æ¥å£
#[async_trait]
pub trait Tool: Send + Sync {
    fn definition(&self) -> ToolDefinition;
    async fn execute(&self, input: serde_json::Value) -> Result<ToolResult, KanataError>;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// crates/kanata-types/src/session.rs
// å®ç°æ–¹: Dev B (kanata-core)
// è°ƒç”¨æ–¹: Dev A (kanata-cli)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/// Agent äº‹ä»¶ (CLI æ¶ˆè´¹çš„æµå¼äº‹ä»¶)
#[derive(Debug, Clone)]
pub enum AgentEvent {
    /// Agent æ­£åœ¨æ€è€ƒ
    Thinking,
    /// æ–‡æœ¬è¾“å‡º delta
    TextDelta(String),
    /// å¼€å§‹è°ƒç”¨å·¥å…·
    ToolStart { name: String, input_preview: String },
    /// å·¥å…·æ‰§è¡Œå®Œæˆ
    ToolEnd { name: String, result_preview: String },
    /// ä¼šè¯ç»“æŸ
    Done { usage: SessionTokenStats },
    /// é”™è¯¯
    Error(String),
}

/// ä¼šè¯ Token ç»Ÿè®¡
#[derive(Debug, Clone, Default)]
pub struct SessionTokenStats {
    pub total_input_tokens: u32,
    pub total_output_tokens: u32,
    pub total_cost_usd: f64,
    pub turns: u32,
    pub model: String,
}

/// Agent ä¼šè¯æ¥å£
#[async_trait]
pub trait AgentSession: Send + Sync {
    /// å‘é€ç”¨æˆ·æ¶ˆæ¯
    async fn send_message(
        &self,
        content: &str,
    ) -> Result<Pin<Box<dyn Stream<Item = AgentEvent> + Send>>, KanataError>;

    /// å½“å‰ä¼šè¯ç»Ÿè®¡
    fn stats(&self) -> SessionTokenStats;

    /// æ‰§è¡Œæ–œæ å‘½ä»¤
    async fn execute_command(&self, cmd: &str, args: &str) -> Result<String, KanataError>;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// crates/kanata-types/src/config.rs
// ä¸‰äººå…±ç”¨
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct KanataConfig {
    /// é»˜è®¤æ¨¡å‹
    pub default_model: String,
    /// API Keys
    pub api_keys: HashMap<String, String>,
    /// ä¿¡ä»»ç­‰çº§ (1-4)
    pub trust_level: u8,
    /// è‡ªå®šä¹‰ prompt è·¯å¾„
    pub prompt_dir: Option<PathBuf>,
    /// é¡¹ç›®è®°å¿†è·¯å¾„
    pub memory_path: Option<PathBuf>,
}
```

---

## äºŒã€äººå‘˜åˆ†å·¥æ˜ç»†

### 2.1 åˆ†å·¥æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                            â”‚
â”‚   Dev A (Baoxing Huai)                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚  L1: è¡¨ç°å±‚                                   â”‚        â”‚
â”‚   â”‚  kanata-cli                                   â”‚        â”‚
â”‚   â”‚                                               â”‚        â”‚
â”‚   â”‚  Â· TUI æ¡†æ¶ (ratatui)                         â”‚        â”‚
â”‚   â”‚  Â· è¾“å…¥å¤„ç† (å¤šè¡Œ/å†å²/è¡¥å…¨)                    â”‚        â”‚
â”‚   â”‚  Â· è¾“å‡ºæ¸²æŸ“ (Markdown/ä»£ç é«˜äº®/Diff)           â”‚        â”‚
â”‚   â”‚  Â· æµå¼å“åº”å®æ—¶æ¸²æŸ“                             â”‚        â”‚
â”‚   â”‚  Â· ä¼šè¯ç®¡ç† (åˆ›å»º/åˆ‡æ¢/æŒä¹…åŒ–)                  â”‚        â”‚
â”‚   â”‚  Â· æ–œæ å‘½ä»¤ç³»ç»Ÿ                                â”‚        â”‚
â”‚   â”‚  Â· ~/.kanata/ é…ç½®ç®¡ç†                         â”‚        â”‚
â”‚   â”‚  Â· ç«å“è¿ç§» (.claude/ â†’ .kanata/)             â”‚        â”‚
â”‚   â”‚  Â· Token æ¶ˆè€—çŠ¶æ€æ æ˜¾ç¤º                        â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                            â”‚
â”‚   Dev B (Junjie Duan)                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚  L2: ç¼–æ’å±‚ + L3a/L3b: å·¥å…·ä¸ Skill           â”‚        â”‚
â”‚   â”‚  kanata-core + kanata-tools + kanata-skills    â”‚        â”‚
â”‚   â”‚                                               â”‚        â”‚
â”‚   â”‚  Â· Agent å¯¹è¯å¾ªç¯ (æ ¸å¿ƒçŠ¶æ€æœº)                  â”‚        â”‚
â”‚   â”‚  Â· ä¸Šä¸‹æ–‡è£…é… (æ¶ˆæ¯å†å²/Token çª—å£ç®¡ç†)         â”‚        â”‚
â”‚   â”‚  Â· å·¥å…·åˆ†å‘ (è§£æ tool_use â†’ è°ƒç”¨ Tool)        â”‚        â”‚
â”‚   â”‚  Â· System Prompt ç®¡ç† (ä»æ–‡ä»¶åŠ è½½)             â”‚        â”‚
â”‚   â”‚  Â· 6 ä¸ªå·¥å…·å®ç° (Read/Write/Edit/Glob/Grep/Bash)â”‚       â”‚
â”‚   â”‚  Â· Tool Registry (æ³¨å†Œ/å‘ç°/Schema ç”Ÿæˆ)       â”‚        â”‚
â”‚   â”‚  Â· Skill Registry (YAML åŠ è½½/è°ƒåº¦)             â”‚        â”‚
â”‚   â”‚  Â· 3 ä¸ªå†…ç½® Skill (commit/review/explain)      â”‚        â”‚
â”‚   â”‚  Â· Project Memory (è¯»å†™ .kanata/memory.yaml)   â”‚        â”‚
â”‚   â”‚  Â· æ“ä½œæ—¥å¿— + Undo åŸºç¡€æœºåˆ¶                    â”‚        â”‚
â”‚   â”‚  Â· å®‰å…¨å±‚ (è·¯å¾„ç™½åå•/å‘½ä»¤é»‘åå•)              â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                            â”‚
â”‚   Dev C (Sihao Li)                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚  L3c: æ¨¡å‹å±‚ + L4: åŸºç¡€è®¾æ–½                    â”‚        â”‚
â”‚   â”‚  kanata-model + CI/CD + é›†æˆæµ‹è¯•               â”‚        â”‚
â”‚   â”‚                                               â”‚        â”‚
â”‚   â”‚  Â· LLM Client ç»Ÿä¸€æŠ½è±¡                         â”‚        â”‚
â”‚   â”‚  Â· Anthropic Messages API é€‚é…å™¨               â”‚        â”‚
â”‚   â”‚  Â· OpenAI å…¼å®¹é€‚é…å™¨ (DeepSeek/Qwen/GPT)       â”‚        â”‚
â”‚   â”‚  Â· SSE æµå¼è§£æ (text + tool_use)              â”‚        â”‚
â”‚   â”‚  Â· Token è®¡æ•° + æˆæœ¬è®¡ç®—å¼•æ“                   â”‚        â”‚
â”‚   â”‚  Â· é‡è¯•é€»è¾‘ (Rate Limit/æŒ‡æ•°é€€é¿/Fallback)     â”‚        â”‚
â”‚   â”‚  Â· API Key æ±  (åŸºç¡€ç‰ˆ: è½®è¯¢ + å¥åº·æ£€æŸ¥)        â”‚        â”‚
â”‚   â”‚  Â· Mock LLM Client (å›¢é˜Ÿå¼€å‘ç”¨)                â”‚        â”‚
â”‚   â”‚  Â· CI/CD æµæ°´çº¿ (GitHub Actions)               â”‚        â”‚
â”‚   â”‚  Â· å¤šå¹³å°æ„å»º (Windows/macOS/Linux)            â”‚        â”‚
â”‚   â”‚  Â· é›†æˆæµ‹è¯•æ¡†æ¶                                â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                            â”‚
â”‚   Sponsor (Jianmin Lu)                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚  Â· æ¯æ—¥ Review è¿›å±•ï¼Œè§£é™¤é˜»å¡                   â”‚        â”‚
â”‚   â”‚  Â· äº§å“å†³ç­– (åŠŸèƒ½å–èˆ/ä¼˜å…ˆçº§è°ƒæ•´)               â”‚        â”‚
â”‚   â”‚  Â· System Prompt å†…å®¹å®¡æ ¸ä¸è°ƒä¼˜                 â”‚        â”‚
â”‚   â”‚  Â· ç«å“åŠ¨æ€è·Ÿè¸ªä¸ç­–ç•¥è°ƒæ•´                      â”‚        â”‚
â”‚   â”‚  Â· ç”¨æˆ·ä½“éªŒæŠŠå…³ (é¦–æ¬¡ä½¿ç”¨æµç¨‹)                  â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ¨¡å—é—´ä¾èµ–ä¸è§£è€¦ç­–ç•¥

```
    Dev A (CLI)                  Dev B (Core+Tools)              Dev C (Model)
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         â”‚                             â”‚                              â”‚
         â”‚  è°ƒç”¨ AgentSession trait     â”‚  è°ƒç”¨ LLMClient trait       â”‚
         â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
         â”‚                             â”‚                              â”‚
         â”‚  Dev A ç”¨ MockAgent         â”‚  Dev B ç”¨ MockLLM           â”‚
         â”‚  å¼€å‘å…¨éƒ¨ UI é€»è¾‘            â”‚  å¼€å‘å…¨éƒ¨ç¼–æ’é€»è¾‘             â”‚
         â”‚  æ— éœ€ç­‰ Dev B               â”‚  æ— éœ€ç­‰ Dev C               â”‚
         â”‚                             â”‚                              â”‚
         â”‚                             â”‚  Dev B çš„ Tools              â”‚
         â”‚                             â”‚  å®Œå…¨ç‹¬ç«‹ï¼Œæ— å¤–éƒ¨ä¾èµ–         â”‚
         â”‚                             â”‚  æ¯ä¸ªå·¥å…·ç‹¬ç«‹å•æµ‹             â”‚

è§£è€¦å…³é”®:
  1. kanata-types åŒ…å«æ‰€æœ‰ trait å®šä¹‰ï¼ŒD1 é”å®šåä¸è½»æ˜“æ”¹åŠ¨
  2. Dev C çš„ MockLLMClient åœ¨ D1 å°±æä¾›ç»™ Dev B
  3. Dev B çš„ MockAgentSession åœ¨ D1 å°±æä¾›ç»™ Dev A
  4. ä¸‰äººå„è‡ªçš„ crate å¯ä»¥ç‹¬ç«‹ç¼–è¯‘ã€ç‹¬ç«‹æµ‹è¯•
```

---

## ä¸‰ã€MVP å‘¨è®¡åˆ’ (Day 1 ~ Day 7)

### Day 1 (å‘¨ä¸€): æ¶æ„æ—¥ â€” å…¨å‘˜å…±å»º

**ç›®æ ‡**: é¡¹ç›®éª¨æ¶æ­å»ºå®Œæˆï¼Œæ¥å£é”å®šï¼Œæ¯äººæ‹¿åˆ°è‡ªå·±çš„ crate å¯ä»¥ç‹¬ç«‹ç¼–ç 

| æ—¶æ®µ | å…¨å‘˜åä½œå†…å®¹ |
|------|------------|
| ä¸Šåˆ | 1. `cargo init --workspace` åˆ›å»ºé¡¹ç›®ç»“æ„ |
|      | 2. åˆ›å»ºæ‰€æœ‰ crate éª¨æ¶ (ç©º lib.rs / main.rs) |
|      | 3. **é€è¡Œç¡®è®¤ kanata-types** æ‰€æœ‰ trait/struct/enum å®šä¹‰ |
|      | 4. ç¡®è®¤ Cargo.toml ä¾èµ–ç‰ˆæœ¬ (tokio, serde, ratatui, reqwest...) |
| ä¸‹åˆ | 5. Dev C å®Œæˆ `MockLLMClient` â†’ äº¤ä»˜ç»™ Dev B |
|      | 6. Dev B å®Œæˆ `MockAgentSession` â†’ äº¤ä»˜ç»™ Dev A |
|      | 7. ä¸‰äººå„è‡ªéªŒè¯: è‡ªå·±çš„ crate èƒ½ `cargo build` é€šè¿‡ |
|      | 8. Dev C æ­å»º CI: push è§¦å‘ `cargo check` + `cargo test` |

**Day 1 äº¤ä»˜ç‰©æ£€æŸ¥æ¸…å•**:
- [ ] `cargo build --workspace` é€šè¿‡
- [ ] `kanata-types` æ‰€æœ‰ trait å®šä¹‰å®Œæˆ
- [ ] `MockLLMClient` å¯è¿”å›é¢„è®¾æµå¼å“åº”
- [ ] `MockAgentSession` å¯è¿”å›é¢„è®¾ AgentEvent æµ
- [ ] CI èƒ½è·‘é€š (å³ä½¿åªæ˜¯ç©ºæµ‹è¯•)
- [ ] æ¯äººçš„ crate æœ‰è‡³å°‘ 1 ä¸ª `#[test]` é€šè¿‡

---

### Day 2 (å‘¨äºŒ): æ ¸å¿ƒéª¨æ¶

| äººå‘˜ | ä»»åŠ¡ | äº¤ä»˜ç‰© | éªŒæ”¶æ ‡å‡† |
|------|------|--------|---------|
| **Dev A** | CLI åŸºç¡€æ¡†æ¶ | `kanata-cli` åŸºç¡€ TUI | ç»ˆç«¯å¯åŠ¨ â†’ æ˜¾ç¤ºæ¬¢è¿è¯­ â†’ æ¥å—è¾“å…¥ â†’ echo å›æ˜¾ â†’ é€€å‡º |
|           | è¾“å…¥ç»„ä»¶ | å¤šè¡Œè¾“å…¥æ¡† | æ”¯æŒ Enter æäº¤ã€Shift+Enter æ¢è¡Œã€ä¸Šä¸‹ç¿»å†å² |
| **Dev B** | Agent ä¸»å¾ªç¯ | `kanata-core` agent.rs | `send_message("hello")` â†’ è°ƒç”¨ MockLLM â†’ è¿”å› AgentEvent æµ |
|           | Read + Write å·¥å…· | `kanata-tools` read.rs/write.rs | è¯»å–æ–‡ä»¶è¿”å›å†…å®¹ï¼›å†™å…¥æ–‡ä»¶åˆ°æŒ‡å®šè·¯å¾„ |
| **Dev C** | Anthropic é€‚é…å™¨ | `kanata-model` anthropic.rs | å¯¹çœŸå® Claude API å‘é€è¯·æ±‚ â†’ æ”¶åˆ°æµå¼æ–‡æœ¬ â†’ è§£æä¸º StreamEvent |
|           | SSE è§£æå™¨ | `kanata-model` stream.rs | æ­£ç¡®è§£æ `event: content_block_delta` ç­‰äº‹ä»¶ |

---

### Day 3 (å‘¨ä¸‰): æ ¸å¿ƒèƒ½åŠ›

| äººå‘˜ | ä»»åŠ¡ | äº¤ä»˜ç‰© | éªŒæ”¶æ ‡å‡† |
|------|------|--------|---------|
| **Dev A** | è¾“å‡ºæ¸²æŸ“ | Markdown æ¸²æŸ“ + ä»£ç é«˜äº® | Agent è¿”å›å«ä»£ç å—çš„æ–‡æœ¬èƒ½æ­£ç¡®é«˜äº®æ˜¾ç¤º |
|           | çŠ¶æ€æ  | Token æ¶ˆè€— + æ¨¡å‹åæ˜¾ç¤º | åº•éƒ¨å®æ—¶æ˜¾ç¤º "Claude Opus Â· 1.2K tokens Â· $0.03" |
| **Dev B** | Tool è°ƒåº¦ | dispatcher.rs | LLM è¿”å› tool_use â†’ è§£æ â†’ è°ƒç”¨ Tool â†’ ç»“æœè¿”å› LLM |
|           | Edit + Glob + Grep | 3 ä¸ªå·¥å…·å®ç° | Edit ç²¾ç¡®æ›¿æ¢ã€Glob æ¨¡å¼åŒ¹é…ã€Grep æ­£åˆ™æœç´¢ |
|           | ä¸Šä¸‹æ–‡ç®¡ç† | context.rs | æ¶ˆæ¯å†å²ç»´æŠ¤ + Token è®¡æ•° + è¶…çª—å£æ—¶æˆªæ–­ |
| **Dev C** | tool_use æµå¼è§£æ | stream.rs å¢å¼º | æ­£ç¡®è§£æ `tool_use` ç±»å‹çš„æµå¼å“åº” (JSON åˆ†ç‰‡æ‹¼æ¥) |
|           | Token ç»Ÿè®¡ | token.rs | ä» API å“åº”æå– usage â†’ è®¡ç®—æˆæœ¬ â†’ è¿”å› TokenUsage |
|           | é‡è¯•é€»è¾‘ | retry.rs | 429 è‡ªåŠ¨ç­‰å¾…é‡è¯•ã€5xx æŒ‡æ•°é€€é¿ã€è¶…æ—¶å¤„ç† |

**Day 3 é‡Œç¨‹ç¢‘**: Dev B ç”¨ MockLLM è·‘é€šå®Œæ•´ Agent Loop (ç”¨æˆ·è¾“å…¥ â†’ LLM â†’ è°ƒç”¨ Read å·¥å…· â†’ ç»“æœå› LLM â†’ æœ€ç»ˆå›å¤)

---

### Day 4 (å‘¨å››): è¡¥å…¨èƒ½åŠ›

| äººå‘˜ | ä»»åŠ¡ | äº¤ä»˜ç‰© | éªŒæ”¶æ ‡å‡† |
|------|------|--------|---------|
| **Dev A** | æµå¼æ¸²æŸ“ | å®æ—¶é€å­—æ˜¾ç¤º | AgentEvent::TextDelta å®æ—¶æ¸²æŸ“ï¼Œä¸ç­‰å…¨éƒ¨å®Œæˆ |
|           | å·¥å…·è°ƒç”¨ UI | å·¥å…·æ‰§è¡ŒçŠ¶æ€å±•ç¤º | æ˜¾ç¤º "ğŸ”§ Reading src/main.rs..." â†’ "âœ“ Done (245 lines)" |
|           | å‘½ä»¤ç³»ç»Ÿ | /help /model /cost /clear | æ–œæ å‘½ä»¤èƒ½æ­£ç¡®è·¯ç”±å’Œæ‰§è¡Œ |
| **Dev B** | Bash å·¥å…· | bash.rs + safety.rs | æ‰§è¡Œå‘½ä»¤ + è¾“å‡ºæˆªæ–­ + `rm -rf /` ç­‰å±é™©å‘½ä»¤æ‹¦æˆª |
|           | Skill æ¡†æ¶ | loader.rs + registry | ä» YAML åŠ è½½ Skill å®šä¹‰ï¼Œæ³¨å†Œåˆ° Registry |
|           | System Prompt | system.md + åŠ è½½é€»è¾‘ | ä»æ–‡ä»¶åŠ è½½ System Promptï¼ŒåŒ…å«å·¥å…·æè¿° |
| **Dev C** | OpenAI å…¼å®¹é€‚é…å™¨ | openai.rs | å¯¹ DeepSeek/GPT API çš„è¯·æ±‚-å“åº”èƒ½æ­£ç¡®è§£æ |
|           | Key æ± åŸºç¡€ | key_pool.rs | å¤š Key è½®è¯¢ + å• Key å¤±è´¥è‡ªåŠ¨åˆ‡æ¢ |
|           | é…ç½®åŠ è½½ | é…åˆ Dev A çš„ config.rs | ä» config.yaml è¯»å– API Key å’Œæ¨¡å‹é…ç½® |

---

### Day 5 (å‘¨äº”): æ‰“ç£¨ + Skill

| äººå‘˜ | ä»»åŠ¡ | äº¤ä»˜ç‰© | éªŒæ”¶æ ‡å‡† |
|------|------|--------|---------|
| **Dev A** | ä¼šè¯ç®¡ç† | session.rs | ä¼šè¯æŒä¹…åŒ–åˆ° ~/.kanata/sessions/ï¼Œé‡å¯åå¯æ¢å¤ |
|           | é¦–æ¬¡ä½¿ç”¨å¼•å¯¼ | é¦–æ¬¡è¿è¡Œ wizard | æ—  config æ—¶å¼•å¯¼ç”¨æˆ·é…ç½® API Key + é€‰æ‹©æ¨¡å‹ |
|           | Diff æ˜¾ç¤º | ä»£ç ä¿®æ”¹ diff æ¸²æŸ“ | Edit å·¥å…·çš„ä¿®æ”¹ä»¥ +/- çº¢ç»¿ diff å±•ç¤º |
| **Dev B** | 3 ä¸ªå†…ç½® Skill | commit / review / explain | `/commit` èƒ½åˆ†æ diff å¹¶ç”Ÿæˆ commit message |
|           | Project Memory | memory.rs | è‡ªåŠ¨æå–å’Œè®°å¿†é¡¹ç›®ä¿¡æ¯åˆ° .kanata/memory.yaml |
|           | Undo æœºåˆ¶ | undo.rs | æ¯æ¬¡å†™æ–‡ä»¶å‰è®°å½•çŠ¶æ€ï¼Œ`/undo` å¯å›æ»š |
| **Dev C** | ç½®ä¿¡åº¦å­—æ®µ | AgentEvent ä¸­åµŒå…¥ confidence | é¢„ç•™ confidence å­—æ®µï¼ŒMVP é»˜è®¤ N/A |
|           | Token æŠ¥å‘Š | ä¼šè¯ç»“æŸæ±‡æ€» | ä¼šè¯ç»“æŸè¾“å‡º: "æœ¬æ¬¡æ¶ˆè€— 3.2K tokens, $0.08" |
|           | å¤šå¹³å°æ„å»º | release.yml | GitHub Actions æ„å»º Windows/macOS/Linux äºŒè¿›åˆ¶ |

---

### Day 6 (å‘¨å…­): é›†æˆæ—¥ â€” å…¨å‘˜è”è°ƒ

**ä¸Šåˆ: é¦–æ¬¡å…¨é“¾è·¯è”è°ƒ**

```
ç›®æ ‡: ç”¨çœŸå® Claude API è·‘é€šå®Œæ•´æµç¨‹

æµ‹è¯•ç”¨ä¾‹ 1 â€” åŸºç¡€å¯¹è¯:
  è¾“å…¥: "ä½ å¥½ï¼Œä»‹ç»ä¸€ä¸‹è‡ªå·±"
  æœŸæœ›: æµå¼æ–‡æœ¬è¾“å‡ºï¼ŒToken ç»Ÿè®¡æ­£ç¡®

æµ‹è¯•ç”¨ä¾‹ 2 â€” æ–‡ä»¶è¯»å–:
  è¾“å…¥: "è¯»å– Cargo.toml çš„å†…å®¹"
  æœŸæœ›: Agent è°ƒç”¨ Read å·¥å…· â†’ è¿”å›æ–‡ä»¶å†…å®¹ â†’ æ€»ç»“ç»™ç”¨æˆ·

æµ‹è¯•ç”¨ä¾‹ 3 â€” ä»£ç ä¿®æ”¹:
  è¾“å…¥: "åœ¨ src/main.rs ä¸­åŠ ä¸€è¡Œæ³¨é‡Š"
  æœŸæœ›: Agent è°ƒç”¨ Edit å·¥å…· â†’ diff é¢„è§ˆ â†’ ç¡®è®¤åå†™å…¥

æµ‹è¯•ç”¨ä¾‹ 4 â€” å¤šè½®å¯¹è¯:
  è¾“å…¥: "è¯»å– src/lib.rs" â†’ "å¸®æˆ‘åŠ ä¸ªå‡½æ•°" â†’ "å†åŠ ä¸ªæµ‹è¯•"
  æœŸæœ›: ä¸Šä¸‹æ–‡è¿è´¯ï¼Œä¸‰è½®å¯¹è¯æ­£ç¡®

æµ‹è¯•ç”¨ä¾‹ 5 â€” Skill:
  è¾“å…¥: "/commit"
  æœŸæœ›: åˆ†æ git diff â†’ ç”Ÿæˆ commit message â†’ ç¡®è®¤åæ‰§è¡Œ
```

**ä¸‹åˆ: Bug Fix + è”è°ƒé—®é¢˜ä¿®å¤**

| å¸¸è§é—®é¢˜ | è´Ÿè´£äºº |
|---------|--------|
| æµå¼æ¸²æŸ“å¡é¡¿/ä¹±ç  | Dev A |
| å·¥å…·è°ƒç”¨ç»“æœæœªæ­£ç¡®å›ä¼  | Dev B |
| SSE è§£æé—æ¼äº‹ä»¶ | Dev C |
| Token è®¡æ•°ä¸å‡† | Dev C |
| å¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡ä¸¢å¤± | Dev B |

---

### Day 7 (å‘¨æ—¥): å‘å¸ƒæ—¥

| æ—¶æ®µ | å†…å®¹ | è´Ÿè´£äºº |
|------|------|--------|
| ä¸Šåˆ | ç«¯åˆ°ç«¯æµ‹è¯• (10 ä¸ªæ ¸å¿ƒåœºæ™¯) | å…¨å‘˜ |
| ä¸Šåˆ | ä¿®å¤é˜»å¡æ€§ Bug | å¯¹åº”è´Ÿè´£äºº |
| ä¸‹åˆ | README.md + å®‰è£…è¯´æ˜ | Dev A |
| ä¸‹åˆ | æ‰“ v0.1.0 tag + æ„å»ºå‘å¸ƒ | Dev C |
| ä¸‹åˆ | Sponsor éªŒæ”¶æµ‹è¯• | Sponsor |
| æ™šä¸Š | å‘å¸ƒ MVP | Dev C æ‰§è¡Œ |

**MVP éªŒæ”¶æ¸…å• (Sponsor ç­¾å­—)**:

- [ ] `kanata` å‘½ä»¤å¯å¯åŠ¨ï¼Œæ˜¾ç¤ºæ¬¢è¿ç•Œé¢
- [ ] é¦–æ¬¡ä½¿ç”¨å¼•å¯¼é…ç½® API Key
- [ ] è‡ªç„¶è¯­è¨€å¯¹è¯æ­£å¸¸ï¼Œæµå¼è¾“å‡º
- [ ] èƒ½è¯»å–é¡¹ç›®æ–‡ä»¶å¹¶ç†è§£å†…å®¹
- [ ] èƒ½ä¿®æ”¹æ–‡ä»¶ï¼Œä¿®æ”¹å‰å±•ç¤º diff
- [ ] èƒ½æ‰§è¡Œ Bash å‘½ä»¤ï¼Œå±é™©å‘½ä»¤è¢«æ‹¦æˆª
- [ ] `/commit` Skill èƒ½ç”Ÿæˆ commit message
- [ ] `/help` æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
- [ ] Token æ¶ˆè€—å®æ—¶æ˜¾ç¤ºåœ¨çŠ¶æ€æ 
- [ ] ä¼šè¯ç»“æŸæ˜¾ç¤ºæˆæœ¬æ±‡æ€»
- [ ] æ”¯æŒ Claude API å’Œ OpenAI å…¼å®¹ API
- [ ] Windows / macOS / Linux å‡å¯è¿è¡Œ

---

## å››ã€MVP åæ¯æ—¥è¿­ä»£èŠ‚å¥

### 4.1 æ¯æ—¥æµç¨‹

```
09:00 â”Œâ”€ ç«™ä¼š (15min) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ æ¯äºº: æ˜¨å¤©å®Œæˆ / ä»Šå¤©è®¡åˆ’ / é˜»å¡ç‚¹              â”‚
      â”‚ Sponsor: ä¼˜å…ˆçº§è°ƒæ•´ / ç«å“åŠ¨æ€                   â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
09:15 â”Œâ”€ å¼€å‘ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ å„è‡ªåœ¨è‡ªå·±çš„ crate ä¸­å¼€å‘                        â”‚
      â”‚ ç”¨ Mock æ¥å£ç‹¬ç«‹æµ‹è¯•                             â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
16:00 â”Œâ”€ é›†æˆ (30min) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ git pull + cargo test --workspace                â”‚
      â”‚ å¿«é€Ÿä¿®å¤é›†æˆé—®é¢˜                                 â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
16:30 â”Œâ”€ è‡ªåŠ¨åŒ– â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ CI è‡ªåŠ¨: lint â†’ test â†’ build â†’ Nightly å‘å¸ƒ      â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
17:00 â”Œâ”€ PR Review (äº’ç›¸) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ A review B, B review C, C review A (è½®è½¬)       â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 MVP åç¬¬ 2~3 å‘¨è¿­ä»£ä¼˜å…ˆçº§

| å‘¨ | Dev A | Dev B | Dev C |
|----|-------|-------|-------|
| **W2** | Vim å¿«æ·é”® + å¤šä¼šè¯ UI + äº¤äº’ä¼˜åŒ– | Context Assembler æ™ºèƒ½åŒ– + æ›´å¤š Skill | Multi-Model è·¯ç”± + DeepSeek/Qwen é€‚é… |
| **W3** | Web ç«¯ Prototype (React) | Multi-Brain åŸºç¡€ (2-Brain éªŒè¯) | Key æ± åŒ–ç®¡ç† + Token Dashboard API |

### 4.3 Git å·¥ä½œæµ

```
main          â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€ (æ¯æ—¥åˆå¹¶ï¼Œä¿æŠ¤åˆ†æ”¯)
                  / \   / \   / \   / \
dev/a-cli    â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—                (Dev A çš„å·¥ä½œåˆ†æ”¯)
dev/b-core   â”€â”€â—â”€â”€â”€â”€â”€â—â”€â”€â”€â—â”€â”€â”€â—              (Dev B çš„å·¥ä½œåˆ†æ”¯)
dev/c-model  â”€â”€â—â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â—             (Dev C çš„å·¥ä½œåˆ†æ”¯)

è§„åˆ™:
  1. main åˆ†æ”¯ä¿æŠ¤ï¼Œä¸å…è®¸ç›´æ¥ push
  2. æ¯ä¸ª PR è‡³å°‘ 1 äºº Review
  3. CI é€šè¿‡æ‰èƒ½åˆå¹¶
  4. æ¯å¤©è‡³å°‘åˆå¹¶ 1 æ¬¡åˆ° main
  5. å†²çªåªå¯èƒ½åœ¨ kanata-types ä¸­å‡ºç° (D1 é”å®šåæå°‘æ”¹åŠ¨)
```

---

## äº”ã€æŠ€æœ¯å†³ç­–é€ŸæŸ¥è¡¨

MVP é˜¶æ®µ**åªç”¨**ä»¥ä¸‹æŠ€æœ¯ï¼Œä¸å¼•å…¥é¢å¤–å¤æ‚åº¦ï¼š

| é¢†åŸŸ | é€‰æ‹© | ç†ç”± | ä¸ç”¨ä»€ä¹ˆ |
|------|------|------|---------|
| è¯­è¨€ | Rust | æ€§èƒ½ + è·¨å¹³å° + ç±»å‹å®‰å…¨ | Go/Python/TS (åç»­ Web ç«¯ç”¨ TS) |
| å¼‚æ­¥ | tokio | Rust å¼‚æ­¥æ ‡å‡† | async-std |
| CLI UI | ratatui + crossterm | æˆç†Ÿçš„ç»ˆç«¯ UI åº“ | cursive, tui-rs (å·²å¼ƒ) |
| HTTP | reqwest | ç®€å•å¯é  | hyper (å¤ªåº•å±‚) |
| SSE | eventsource-stream æˆ–æ‰‹å†™ | æ¨¡å‹ API éƒ½æ˜¯ SSE | WebSocket (ä¸éœ€è¦) |
| JSON | serde + serde_json | Rust æ ‡å‡† | simd-json (è¿‡åº¦ä¼˜åŒ–) |
| é…ç½® | serde_yaml | YAML å¯è¯»æ€§å¥½ | toml (åµŒå¥—æ·±æ—¶éš¾è¯») |
| æ–‡ä»¶æœç´¢ | globset + grep-regex | ripgrep åº•å±‚åº“ | æ‰‹å†™æ­£åˆ™ |
| Markdown | termimad æˆ– comrak | ç»ˆç«¯ Markdown æ¸²æŸ“ | æ‰‹å†™è§£æ |
| ä»£ç é«˜äº® | syntect | VS Code åŒæ¬¾é«˜äº®å¼•æ“ | tree-sitter (MVP å¤ªé‡) |
| æµ‹è¯• | cargo test + mockall | æ ‡å‡† + Mock åº“ | å¤–éƒ¨æµ‹è¯•æ¡†æ¶ |

---

## å…­ã€å…³é”®é£é™©ä¸é¢„æ¡ˆ

| # | é£é™© | æ¦‚ç‡ | å½±å“ | é¢„æ¡ˆ | è´Ÿè´£äºº |
|---|------|------|------|------|--------|
| 1 | Anthropic API tool_use æµå¼è§£æå¤æ‚ | é«˜ | é˜»å¡ D3 | Dev C æå‰ç ”ç©¶ï¼ŒD2 åš spikeï¼›å¦‚å®åœ¨æä¸å®šç”¨éæµå¼é™çº§ | Dev C |
| 2 | ratatui æµå¼æ¸²æŸ“é—ªçƒ | ä¸­ | ä½“éªŒå·® | åŒç¼“å†²æ¸²æŸ“ï¼›å‚è€ƒ Claude Code CLI çš„æ¸²æŸ“ç­–ç•¥ | Dev A |
| 3 | Agent å¾ªç¯ä¸­ tool_use JSON åˆ†ç‰‡æ‹¼æ¥ | é«˜ | é€»è¾‘é”™è¯¯ | Dev B + Dev C åœ¨ D1 å¯¹é½æ•°æ®æ ¼å¼ï¼›å†™å……åˆ†çš„ snapshot æµ‹è¯• | Dev B + C |
| 4 | kanata-types æ¥å£éœ€è¦ä¿®æ”¹ | ä¸­ | é˜»å¡æ‰€æœ‰äºº | D1 å……åˆ†è®¨è®ºï¼›å¦‚å¿…é¡»æ”¹ï¼Œåœ¨ç«™ä¼šåŒæ­¥ï¼Œä¸‰äººåŒæ—¶æ”¹ | å…¨å‘˜ |
| 5 | Windows å¹³å°å…¼å®¹é—®é¢˜ | ä¸­ | å‘å¸ƒå»¶è¿Ÿ | Dev C çš„ CI ä» D1 å°±åŒ…å« Windows æ„å»ºï¼›è·¯å¾„ç”¨ PathBuf ä¸ç¡¬ç¼–ç  | Dev C |
| 6 | MVP èŒƒå›´è”“å»¶ | é«˜ | å»¶æœŸ | Sponsor æŠŠå…³ï¼Œä»»ä½•æ–°éœ€æ±‚è¿› backlog ä¸è¿› MVPï¼›ä¸¥æ ¼åªåšæ¸…å•å†…çš„ | Sponsor |

---

## ä¸ƒã€æ²Ÿé€šæœºåˆ¶

| æ¸ é“ | ç”¨é€” | é¢‘ç‡ |
|------|------|------|
| æ¯æ—¥ç«™ä¼š (çº¿ä¸Š/çº¿ä¸‹) | è¿›åº¦åŒæ­¥ã€é˜»å¡è§£é™¤ | æ¯æ—¥ 09:00, 15 min |
| IM ç¾¤ (é£ä¹¦/å¾®ä¿¡) | å®æ—¶é—®é¢˜ã€æ¥å£è®¨è®º | éšæ—¶ |
| GitHub PR | ä»£ç  Review | æ¯æ—¥è‡³å°‘ 1 ä¸ª PR |
| GitHub Issues | Bug è·Ÿè¸ªã€ä»»åŠ¡ç®¡ç† | æŒ‰éœ€åˆ›å»º |
| å‘¨äº” Demo | å‘ Sponsor æ¼”ç¤ºå‘¨è¿›å±• | æ¯å‘¨äº” |

---

## å…«ã€ç­¾å­—é¡µ

| è§’è‰² | å§“å | ç¡®è®¤ |
|------|------|------|
| Sponsor | Jianmin Lu | â˜ |
| Developer A | Baoxing Huai | â˜ |
| Developer B | Junjie Duan | â˜ |
| Developer C | Sihao Li | â˜ |

æ—¥æœŸ: 2026-01-__

---

*æœ¬æ–‡æ¡£ç”± Kanata Team åˆ¶å®šï¼Œç‰ˆæœ¬ v1.0*
